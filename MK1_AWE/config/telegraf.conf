# Telegraf Configuration for Gen3 AWE Test Rig
# Hardware: NI cDAQ-9187, Pico TC-08, 3x BGA244, Single PSU

[agent]
  interval = "1s"
  round_interval = true
  metric_batch_size = 5000      # Increased for 100Hz NI data (~1600 points/sec)
  metric_buffer_limit = 50000   # 10x batch size for buffering
  collection_jitter = "0s"
  flush_interval = "1s"
  flush_jitter = "0s"
  precision = ""                 # Empty = use timestamp from input data
  hostname = "Gen3_AWE"
  omit_hostname = false

# ═══════════════════════════════════════════════════════════════
# OUTPUT
# ═══════════════════════════════════════════════════════════════

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "$INFLUXDB_ADMIN_TOKEN"
  organization = "electrolyzer"
  bucket = "electrolyzer_data"
  timeout = "5s"

# ═══════════════════════════════════════════════════════════════
# HARDWARE INPUTS
# ═══════════════════════════════════════════════════════════════

# NI cDAQ-9187 Analog Inputs (16 channels, 4-20mA)
# Bridge samples at 100Hz, returns batch of ~100 samples per poll
[[inputs.http]]
  urls = ["http://host.docker.internal:8881/metrics"]
  timeout = "5s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "ni_cdaq"
    module_type = "ni9253"
    location = "gen3_test_rig"

# Pico TC-08 Thermocouples (8 channels, K-type)
# Bridge samples at 1Hz internally, Telegraf polls every 1s
[[inputs.http]]
  urls = ["http://host.docker.internal:8882/metrics"]
  timeout = "2s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "pico_tc08"
    location = "gen3_test_rig"

# PSU Monitoring Bridge
[[inputs.http]]
  urls = ["http://host.docker.internal:8883/metrics"]
  timeout = "2s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "psu"
    location = "gen3_test_rig"

# Binary Gas Analyzer 1 (BGA01)
[[inputs.http]]
  urls = ["http://host.docker.internal:8888/metrics"]
  timeout = "2s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "bga244"
    bga_id = "BGA01"
    location = "gen3_test_rig"

# Binary Gas Analyzer 2 (BGA02)
[[inputs.http]]
  urls = ["http://host.docker.internal:8889/metrics"]
  timeout = "2s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "bga244"
    bga_id = "BGA02"
    location = "gen3_test_rig"

# Binary Gas Analyzer 3 (BGA03)
[[inputs.http]]
  urls = ["http://host.docker.internal:8890/metrics"]
  timeout = "2s"
  interval = "1s"
  data_format = "influx"
  
  [inputs.http.tags]
    hardware = "bga244"
    bga_id = "BGA03"
    location = "gen3_test_rig"

# ═══════════════════════════════════════════════════════════════
# SYSTEM MONITORING
# ═══════════════════════════════════════════════════════════════

[[inputs.cpu]]
  percpu = false
  totalcpu = true
  collect_cpu_time = false
  report_active = false

[[inputs.mem]]

[[inputs.disk]]
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]
